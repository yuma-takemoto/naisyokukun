{% extends "store_base.html" %}
{% block store_content %}
<h2>データ解析</h2>

<table class="table">
  <thead>
    <tr>
      <th>日付</th>
      <th>席</th>
      <th>ホスト</th>
      <th>姫</th>
      <th>合計(¥)</th>
      <th>歩合計(¥)</th>
    </tr>
  </thead>
  <tbody>
    {# 新しいものを上にしたい場合は |reverse で反転 #}
    {% for s in sales|reverse %}
      <tr>
        <td>{{ s['date'] }}</td>
        <td>{{ s['seat_label'] }}</td>
        <td>{{ host_map.get(s['host_id'], '未登録') }}</td>
        <td>{{ s.get('guest_name','') }}</td>
        <td>¥{{ '%.0f'|format(s.get('total', 0)) }}</td>
        <td>
          ¥{{ '%.0f'|format(s.get('commission_total', 0)) }}
          <a
            class="btn"
            style="margin-left:6px;padding:2px 8px;font-size:12px;"
            href="{{ url_for('admin.store_invoice', sale_id=s['id']) }}"
            target="_blank" rel="noopener"
          >請求書</a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
